<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Porteføljeoversigt</title>
  <link href="/portefoljeOversigt.css" rel="stylesheet" />
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
</head>

<body>
  <!--sidemenu -->
  <div class="sidemenu">
    <div class="WebappLogo">
      <img src="/logo.jpeg" alt="WebappLogo">
    </div>

    <button class="pil" onclick="skiftMenu()">
      <i class='bx bxs-chevron-left'></i>
    </button>

    <ul class="menuValg">
      <li><a href="/dashboard"><i class='bx bx-home'></i>Dashboard</a></li>
      <li><a href="/konto/oversigt"><i class='bx bxs-user-account'></i>Konti</a></li>
      <li><a href="/portefolje/oversigt"><i class='bx bx-doughnut-chart'></i>Porteføljer</a></li>
      <li><a href="/indstillinger"><i class='bx bx-cog'></i>Indstillinger</a></li>
    </ul>

    <ul class="logUd">
      <li><a href="/login"><i class='bx bx-log-out'></i>Log ud</a></li>
    </ul>
  </div>

  <!--indhold på siden-->
  <div class="indhold">
    <h1 class="overskrift">Porteføljeoversigt</h1>

    <!--tilføj portefølje-knap-->
    <div class="tilføjKnapBox">
      <a href="/portefolje/opret" class="tilføjKnap">Opret ny portefølje</a>
    </div>      

    <!--øverste sektion med samlede indhold-->
    <div class="øversteIndhold">
      <!--venstre side med total værdi og ændringer-->
      <div class="venstreSide">
        <div class="venstreØvreBoks">
          Total værdi i DKK:
          <%= new Intl.NumberFormat('da-DK', { style: 'currency', currency: 'DKK' }).format(totalVærdi || 0) %> <!--viser samlet værdi formateret til DKK-->
        </div>
        <div class="ændringer"> <!--benytter fake data-->
          <span>Ændring i 24 timer: <span class="grøn">+0,70%</span></span>
          <span>Ændring i 7 dage: <span class="grøn">+3,47%</span></span>
          <span>Ændring i 30 dage: <span class="grøn"> +5,77%</span></span>
         
        </div>
      </div>

      <div class="højreØvreBoks">
        <h3>Fordeling af værdi i porteføljer</h3>
        <div id="donutChart" style="max-width: 380px; margin: auto;"></div> <!--plads til graf-->
      </div>
    </div>

    <!--oversigt over eksisterende porteføljer-->
    <div class="oversigtBox">
      <div class="listeOverskrifter">
        <span>Portefølje Navn</span>
        <span>Bank Account</span>
        <span>Sidste Handel</span>
        <span>Total Value</span>
      </div>
    
      <% if (porteføljer.length > 0) { %> <!--tjekker om der er porteføljer-->
        <% porteføljer.forEach(p => { %> <!--looper gennem porteføljer-->
          <a href="/portefolje/<%= p.porteføljeID %>" class="porteføljeRækkeLink"> <!--gør rækkerne klikbarer-->
            <div class="porteføljeRække"> 
              <div><%= p.navn %></div> 
              <div><%= p.kontonavn %></div> 
              <div>
                <% if (p.sidsteHandelsDato) { %> <!--hvis der er en dato-->
                  <%= new Date(p.sidsteHandelsDato).toLocaleDateString("da-DK") %> <!--formater dato-->
                <% } else { %>
                  <p>Ingen handler endnu</p>
                <% } %>
              </div>
              <div>
                <%= new Intl.NumberFormat('da-DK', { style: 'currency', currency: 'DKK' }).format(p.totalValue || 0) %> <!--formater værdi-->
              </div>
            </div>
          </a>
        <% }); %>
      <% } else { %>
        <p>Ingen porteføljer fundet endnu.</p>
      <% } %>
    </div>
    
      
      

  <script> //funktion til at åbne og lukke side menu
    const sidemenu = document.querySelector('.sidemenu');
    function skiftMenu() {
      sidemenu.classList.toggle('lukket');
    }

    function toggleKontoMenu() { //funktion til at åbne/lukke konto-menu dropdown
      const menu = document.getElementById('kontoMenu');
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block'; //tjekker om menu allerede er block som er synlig så skjuler vi den med none
    }

    function togglePortefoljeMenu() { //Funktion til at åbne/lukke portefølje-menu dropdown
      const menu = document.getElementById('portefoljeMenu');
      menu.style.display = menu.style.display === 'block' ? 'none' : 'block'; //tjekker om menu allerede er block som er synlig så skjuler vi den med none
    }
  </script>

  <!--apexCharts bibliotek-->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script> <!--henter apexcharts bibliotek-->

  <script>
    var options = {
      chart: {
        type: 'donut',
      },
      series: [35000, 12000, 24000, 14000, 15000], //statisk data 
      labels: ['Growth Tech', 'Tech Leaders', 'ETF +', 'Space & Defence', 'E-Com'], //labels til hver aktie
      responsive: [{
        breakpoint: 480,
        options: {
          chart: {
            width: 320
          },
          legend: {
            position: 'bottom'
          }
        }
      }]
    };

    var chart = new ApexCharts(document.querySelector("#donutChart"), options); //opretter en ny doghnut chart
    chart.render(); //viser diagrammet på siden
  </script>
</body>
</html>
