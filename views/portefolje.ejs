<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= portefølje.navn %></title>
  <link href="/portefolje.css" rel="stylesheet">
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel="stylesheet">
</head>

<body>
  <!--sidemenu navigation-->
  <div class="sidemenu">
    <div class="WebappLogo">
      <img src="/logo.jpeg" alt="WebappLogo">
    </div>

    <button class="pil" onclick="skiftMenu()"> 
      <i class='bx bxs-chevron-left'></i>
    </button>

    <ul class="menuValg">
      <li><a href="/dashboard"><i class='bx bx-home'></i>Dashboard</a></li>
      <li><a href="/konto/oversigt"><i class='bx bxs-user-account'></i>Konti</a></li>
      <li><a href="/portefolje/oversigt"><i class='bx bx-doughnut-chart'></i>Porteføljer</a></li>
      <li><a href="/indstillinger"><i class='bx bx-cog'></i>Indstillinger</a></li>
    </ul>

    <ul class="logUd">
      <li><a href="/login"><i class='bx bx-log-out'></i>Log ud</a></li>
    </ul>
  </div>

  <!--indhold -->
  <div class="indhold">

    <div class="overskrift">
      <h1><%= portefølje.navn %></h1>

      <!--søgefelt-->
<<<<<<< Updated upstream
      <form action="/portefolje/<%= portefølje.porteføljeID %>/searchPapir" method="GET" class="søgForm"> <!--angive hvilken rute dataen skal sendes til nårformularen sendes, porteføljeID sættes ind dynamisk-->
=======
      <form action="/portefolje/<%= portefølje.porteføljeID %>/searchPapir" method="GET" class="søgForm">
>>>>>>> Stashed changes
        <input type="text" name="query" placeholder="Søg efter navn på værdipapir" required>
        <button type="submit">Søg</button>
      </form>

      <!--handelshistorik-knap-->
      <div class="tilføjKnapBox">
<<<<<<< Updated upstream
        <form action="/portefolje/<%= portefølje.porteføljeID %>/handelshistorik" method="GET" class="tilføjKnap"> <!--definere rute og henter porteføljeID dynamisk-->
=======
        <form action="/portefolje/<%= portefølje.porteføljeID %>/handelshistorik" method="GET" class="tilføjKnap">
>>>>>>> Stashed changes
          <button type="submit">Handelshistorik</button>
        </form>
      </div>
    </div>

    <!--øverste sektion -->
    <div class="øverste">
      <div class="grafboks">
        <h3>Samlet værdi</h3>
        <% if (værdipapirer.length > 0) { %> <!--ejs if sætning der tjekker om der er nogle værdipapir i porteføljen-->
          <p><%= samletVærdi.toLocaleString('da-DK', { style: 'currency', currency: 'DKK' }) %></p>
        <% } else { %>
          <p><em>Ingen værdipapirer i porteføljen endnu</em></p>
        <% } %>


     <!--linje graf-->
       <div id="lineChart" style="width: 100%; max-width: 900px; height: 400px;"></div> <!--målene til grafen-->
      </div>

      <div class="højresideboks">
        <div class="diagramBoks">
          <h3>Fordeling af værdi</h3>
          <div id="pieChart"></div> 
        </div>
        <div class="højrenedreboks">
          <h3>Dato oprettet</h3>
<<<<<<< Updated upstream
          <p><%= new Date(portefølje.oprettelsesDato).toLocaleDateString('da-DK') %></p> <!--dataoprettelse for porteføljen-->
=======
          <p><%= new Date(portefølje.oprettelsesDato).toLocaleDateString('da-DK') %></p>
>>>>>>> Stashed changes
        </div>
      </div>
    </div>

    <!--oversigt over værdipapirer -->
    <div class="oversigtBox">
      <h3>Værdipapirer i portefølje</h3>
      <div class="listeOverskrifter">
        <span>Navn</span>
        <span>Symbol</span>
        <span>Købsdato</span>
      </div>
    
      <% if (værdipapirer.length > 0) { %> <!--ejs if der er værdipapirer i porteføljen-->
        <% værdipapirer.forEach(v => { %> <!--looper igennem værdipapir-->
          <a href="/portefolje/vaerdipapir/<%= v.id %>" class="aktieLink"> <!--link til at se detaljer om det enkelte værdipapir-->
            <div class="aktieRække"> 
              <div><%= v.navn || 'Ukendt' %></div> <!--vis værdipapir navn hvis navn ikke findes sæt som ukendt-->
              <div><%= v.tickerSymbol || 'Ukendt' %></div>
              <div>
                <% if (v.datoKøbt) { %> <!--tjekker om datoen findes-->
                  <%= new Date(v.datoKøbt).toLocaleDateString('da-DK') %>
                <% } else { %>
                  <em>Ukendt</em>
                <% } %>
              </div>
            </div> 
          </a>          
        <% }) %>
      <% } else { %>
        <p><em>Ingen værdipapirer fundet endnu.</em></p>
      <% } %>
    </div>
    

    <script>
      const sidemenu = document.querySelector('.sidemenu'); //funktion der åbner og lukker side menu 
      function skiftMenu() {
        sidemenu.classList.toggle('lukket');
      }
    </script>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script> <!--henter Apex charts biblioteket-->
<script>
  const værdipapirer = <%- JSON.stringify(værdipapirer) %>; //overfører værdipapirer som json til javascript 

  const labels = værdipapirer.map(p => p.navn || 'Ukendt'); //benytter map til at oprette et array af navne til grafen
  const series = værdipapirer.map(p =>
    !isNaN(p.pris) && !isNaN(p.antal) ? p.antal * p.pris : 0 //opretter et nyt array med den samlede værdi af hvert værdipapir (antal * pris). Hvis pris eller antal mangler eller ikke er et tal, indsættes 0 som fallback
  );

  const pieOptions = { //konfirguation for pie chart
    chart: {
      type: 'pie',
      height: '75%',
      width: '100%'
    },
    series: series, //data der skal vises i diagrammet
    labels: labels, //labels til hver stykke i diagrammet
    legend: {
      position: 'bottom',
      fontSize: '9px'
    },
    tooltip: {
      y: {
        formatter: function (val) {
          return val.toLocaleString('da-DK', { style: 'currency', currency: 'DKK' }); //formatere værdi til dansk valuta
        }
      }
    },
    responsive: [{
      breakpoint: 768,
      options: {
        legend: {
          position: 'bottom'
        }
      }
    }]
  };

  const pieChart = new ApexCharts(document.querySelector("#pieChart"), pieOptions); //opretter pie chart emd id piechart
  pieChart.render(); //tegner cirkeldiagrammet på siden
</script>

  
  
  <script>
    const historik = <%- JSON.stringify(historik) %>; //overfører historik data fra serveren til javascript
  
    const datoer = historik.map(h => h.dato); //tager datoer fra historik
    const værdier = historik.map(h => h.værdi); //tager værdier fra historik
  
    const lineOptions = { ///konfirguation for linje chart
      chart: {
        type: 'line',
        toolbar: { show: false }
      },
      series: [{
        name: 'Urealiseret værdi', //navn på dataserie 
        data: værdier //data der skal vises
      }],
      xaxis: {
        categories: datoer,
        title: { text: 'Dato' }
      },
      yaxis: {
        title: { text: 'Værdi i DKK' },
        labels: {
          formatter: val => val.toFixed(2) + ' kr.'
        }
      },
      tooltip: {
        y: {
          formatter: val => val.toLocaleString('da-DK', { style: 'currency', currency: 'DKK' }) //valuta formatering
        }
      }
    };
  
    const lineChart = new ApexCharts(document.querySelector("#lineChart"), lineOptions); //opretter linje graf
    lineChart.render(); //viser grafen på siden 
  </script>
  
  
</body>
</html>
